log_format h3cpost '$remote_addr\t$remote_user\t[$time_local]\t"$request"\t$status\t$bytes_sent\t'
                '"$http_referer"\t"$http_user_agent"\t"$http_cookie"\t' '$request_body';

server
{
    listen 443;
    server_name fwqaq.ctyun.cn asset.cloudguarder.com;
    #root /data/app/www/titan-frontend;
    root /data/app/conf/maintenance_page;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/infutian.org.log;
    rewrite ^(.*)$ http://$host$1 permanent;
    ssl on;
    ssl_certificate /data/app/conf/cert/server.pem;
    ssl_certificate_key  /data/app/conf/cert/server.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers  ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;

    ssl_session_timeout 5m;
    ssl_session_cache builtin:1000 shared:SSL:10m;

    if ($request_filename ~* (.*)\/\.svn){
        return 404;
    }
    error_page 404 = @upgrade;
    location @upgrade {
        rewrite ^(.*)$ / redirect;
    }
    location / {
    }

}

server
{
    listen 80;
    server_name fwqaq.ctyun.cn asset.cloudguarder.com;
    #root /data/app/www/titan-frontend;
    root /data/app/conf/maintenance_page;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/infutian.org.log;

    rewrite /agent/download /php/agent/download last;
    rewrite /agent/installer /php/agent/installer last;
    rewrite /agent/winDownloader /php/agent/windownloader last;
    rewrite /agent/winInstaller /php/agent/wininstaller last;
    rewrite /testrun/ayok /v1/api/front/ping last;

    if ($request_filename ~* (.*)\/\.svn){
        return 404;
    }
    error_page 404 = @upgrade;
    location @upgrade {
        rewrite ^(.*)$ / redirect;
    }
    location / {
    }

    location ^~ /php/agent/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/api/front {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/assets/ {
        proxy_set_header server_name $host;
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /bigdata/flask {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /api/v3/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server
{
    listen 80;
    server_name   console.qingteng.cn;
    rewrite ^(.*)$ https://$server_name$1 permanent;
    #root /data/app/www/titan-frontend;
    root /data/app/conf/maintenance_page;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/front-qingteng-me.log;
    
    if ($request_filename ~* (.*)\/\.svn){
        return 404;
    }
    error_page 404 = @upgrade;
    location @upgrade {
        rewrite ^(.*)$ / redirect;
    }
    location / {
    }

    rewrite /agent/download /php/agent/download last;
    rewrite /agent/installer /php/agent/installer last;
    rewrite /agent/winDownloader /php/agent/windownloader last;
    rewrite /agent/winInstaller /php/agent/wininstaller last;
    rewrite /testrun/ayok /v1/api/front/ping last;
    rewrite /agent/aixdownload /php/agent/aixdownload last;
    rewrite /agent/aixinstaller /php/agent/aixinstaller last;
    rewrite /agent/solarisdownload /php/agent/solarisdownload last;
    rewrite /agent/solarisinstaller /php/agent/solarisinstaller last;

    location ^~ /php/agent/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/api/front {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/assets/ {
        proxy_set_header server_name $host;
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /bigdata/flask {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
   location ^~ /api/v3/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server
{
    listen 443;
    ssl on;
    ssl_certificate /data/app/conf/cert/server.pem;
    ssl_certificate_key  /data/app/conf/cert/server.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers  ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;
    ssl_session_timeout 5m;
    ssl_session_cache builtin:1000 shared:SSL:10m;
    server_name console.qingteng.cn ;
    #root /data/app/www/titan-frontend;
    root /data/app/conf/maintenance_page;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/front-qingteng-me.log;
    
    if ($request_filename ~* (.*)\/\.svn){
        return 404;
    }
    error_page 404 = @upgrade;
    location @upgrade {
        rewrite ^(.*)$ / redirect;
    }
    location / {
    }

    rewrite /agent/download /php/agent/download last;
    rewrite /agent/installer /php/agent/installer last;
    rewrite /agent/winDownloader /php/agent/windownloader last;
    rewrite /agent/winInstaller /php/agent/wininstaller last;
    rewrite /testrun/ayok /v1/api/front/ping last;
    rewrite /agent/aixdownload /php/agent/aixdownload last;
    rewrite /agent/aixinstaller /php/agent/aixinstaller last;
    rewrite /agent/solarisdownload /php/agent/solarisdownload last;
    rewrite /agent/solarisinstaller /php/agent/solarisinstaller last;

    location ^~ /php/agent/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/api/front {
        proxy_set_header server_name $host;
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/assets/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }

    location ^~ /bigdata/flask {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /api/v3/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server
{
    listen 8000;
    server_name iner-api.qingteng.cn;
    root /data/app/www/titan-web/inner-api/public;
    include /data/app/conf/nginx.location.conf;
    error_log /data/titan-logs/nginx/inner_api_qingteng_error.log;
    location / {
        rewrite ^/(.*) /index.php?$1 last;
        break;
    }
}

server
{
    listen 8001;
    server_name api.qingteng.cn;
    root /data/app/www/titan-web/api/public;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/api_qingteng_me.log;
    error_log   /data/titan-logs/nginx/api_qingteng_error.log;

    location ^~ /v3/update/do {
        proxy_pass http://10.10.106.226/api/preupdate/do;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header referer "http://106.75.73.229";
    }

    location / {
        rewrite ^/(.*) /index.php?$1 last;
        break;
    }
}

server
{
    listen 65512;
    ssl on;
    ssl_certificate /data/app/conf/cert/server.pem;
    ssl_certificate_key  /data/app/conf/cert/server.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers  ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;
    ssl_session_timeout 5m;
    ssl_session_cache builtin:1000 shared:SSL:10m;
    server_name console.qingteng.cn ;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/h3c.log h3cpost;

    if ($request_uri  ~* "/.*\.\..*") {
        return 404;
    }
    if ($request_filename ~* (.*)\/\.svn){
            return 404;
    }
    ssl_verify_client on;
    ssl_client_certificate /data/app/conf/cert/cacert.pem;
    location ^~ / {
        proxy_pass http://titan-gateway:6000;
    }
}

server
{
    listen 443;
    server_name   pre-console.qingteng.cn;
    ssl on;
    ssl_certificate /data/app/conf/cert/server.pem;
    ssl_certificate_key  /data/app/conf/cert/server.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers  ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;
    ssl_session_timeout 5m;
    ssl_session_cache builtin:1000 shared:SSL:10m;
    server_name console.qingteng.cn ;
    root /data/app/www/titan-frontend;
    include /data/app/conf/nginx.location.conf;
    access_log /data/titan-logs/nginx/front-qingteng-me.log;
    if ($request_uri  ~* "/.*\.\..*") {
        return 404;
    }
    if ($request_filename ~* (.*)\/\.svn){
        return 404;
    }

    rewrite /agent/download /php/agent/download last;
    rewrite /agent/installer /php/agent/installer last;
    rewrite /agent/winDownloader /php/agent/windownloader last;
    rewrite /agent/winInstaller /php/agent/wininstaller last;
    rewrite /testrun/ayok /v1/api/front/ping last;
    rewrite /agent/aixdownload /php/agent/aixdownload last;
    rewrite /agent/aixinstaller /php/agent/aixinstaller last;
    rewrite /agent/solarisdownload /php/agent/solarisdownload last;
    rewrite /agent/solarisinstaller /php/agent/solarisinstaller last;

    location ^~ /php/agent/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/api/front {
        proxy_set_header server_name $host;
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
    location ^~ /v1/assets/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }

    location ^~ /bigdata/flask {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
   location ^~ /api/v3/ {
        proxy_pass http://titan-gateway:6000;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}
