---
# defaults file for common
namespace: qtsa
service_account: titan-sa
registry: registry.qingteng.cn/titan-container
use_registry_key: false

alpine_image: "{{ registry }}/alpine:3.14"
glusterfs_image: "{{ registry }}/titan-glusterfs:8.5-20220318"
localpv_image: "{{ registry }}/local-path-provisioner:3.4.0-20220330"
csi_glusterfs_image: "{{ registry }}/csi-glusterfs:v3.1.0-20220329"
csi_livenessprobe_image: "{{ registry }}/livenessprobe:v2.5.0"
csi_provisioner_image: "{{ registry }}/csi-provisioner:v2.2.2"
csi_registrar_image: "{{ registry }}/csi-node-driver-registrar:v2.4.0"

zookeeper_image: "{{ registry }}/titan-zookeeper:3.6.3-20220402"
kafka_image: "{{ registry }}/titan-kafka:2.3.1-20220318"
rabbitmq_image: "{{ registry }}/rabbitmq:3.8.27-management-alpine"
redisjava_image: "{{ registry }}/redis:6.2.4-alpine3.14"
redisphp_image: "{{ registry }}/redis:6.2.4-alpine3.14"
rediserl_image: "{{ registry }}/redis:6.2.4-alpine3.14"
mongo_image: "{{ registry }}/titan-mongo:4.4.6-20220318"
mysql_image: "{{ registry }}/mariadb:10.5.15-focal"
fluentbit_image: "{{ registry }}/titan-fluent-bit:v1.8.5-20220111"
rules_image: "{{ registry }}/titan-rules:3.4.0.10-20220405"

dbbackup_image: "{{ registry }}/titan-backup:3.4.1.28-20220318"
keepalived_image: "{{ registry }}/titan-keepalived:v2.2.1-20220329"
init_image: "{{ registry }}/titan-dockerize:3.4.0-20220330"

# 最终打完整独立部署安装包时，build.sh里自动修改此值
common_tag: COMMON_TAG

sysinfo_image: "{{ registry }}/titan-sysinfo:{{common_tag}}"
wisteria_image: "{{ registry }}/titan-java-wisteria:{{common_tag}}"
upgradetool_image: "{{ registry }}/titan-upgradetool:{{common_tag}}"
gateway_image: "{{ registry }}/titan-java-gateway:{{common_tag}}"
usersrv_image: "{{ registry }}/titan-java-user-srv:{{common_tag}}"
connectagent_image: "{{ registry }}/titan-java-connect-agent:{{common_tag}}"
connectdh_image: "{{ registry }}/titan-java-connect-dh:{{common_tag}}"
connectselector_image: "{{ registry }}/titan-java-connect-selector:{{common_tag}}"
connectsh_image: "{{ registry }}/titan-java-connect-sh:{{common_tag}}"
detectsrv_image: "{{ registry }}/titan-java-detect-srv:{{common_tag}}"
uploadsrv_image: "{{ registry }}/titan-java-upload-srv:{{common_tag}}"
uploadsrv_cdc_image: "{{registry}}/titan-java-upload-srv-cdc:{{common_tag}}"
uploadsrv_ave_image: "{{registry}}/titan-java-upload-srv-tav-ave:{{common_tag}}"
jobsrv_image: "{{ registry }}/titan-java-job-srv:{{common_tag}}"
agent_image: "{{registry}}/titan-agent:{{common_tag}}"
php_image: "{{ registry }}/titan-web-php:{{common_tag}}"
patrol_image: "{{ registry }}/titan-go-patrol:{{common_tag}}"
antivirussrv_image: "{{ registry }}/titan-java-anti-virus-srv:{{common_tag}}"
eventsrv_image: "{{ registry }}/titan-java-event-srv:{{common_tag}}"
mssrv_image: "{{ registry }}/titan-java-ms-srv:{{common_tag}}"
scansrv_image: "{{ registry }}/titan-java-scan-srv:{{common_tag}}"
clusterlinksrv_image: "{{ registry }}/titan-java-cluster-link-srv:{{common_tag}}"


presetrule: Y


storageName: "qt-local-path"
defaultStoragePath: "/data/titan-container"
titan_logsall_path: "/data/titan-logs-all/"
titan_logs_path: "/data/titan-logs"
dfs_storage_capacity: 300Gi
logsall_storage_capacity: 300Gi

fluentbit_sidecar_pullPolicy: IfNotPresent
fluentbit_sidecar_req_memory: 30Mi
fluentbit_sidecar_limit_memory: 80Mi
fluentbit_server_port: 24224

redis_java_master_num: 3
redis_java_slave_num: 1
redis_php_master_num: 3
redis_php_slave_num: 1
redis_erl_master_num: 3
redis_erl_slave_num: 1

glusterfs_nodelabel: "{{namespace}}-glusterfs"
localpv_provisioner_nodelabel: "{{namespace}}-base"
csi_controller_nodelabel: "{{namespace}}-base"
kafka_nodelabel: "{{namespace}}-base"
mongocs_nodelabel: "{{namespace}}-base"
mongos_nodelabel: "{{namespace}}-base"
mongoshard_nodelabel: "{{namespace}}-base"
mysql_nodelabel: "{{namespace}}-base"
zk_nodelabel: "{{namespace}}-base"
rabbitmq_nodelabel: "{{namespace}}-base"
rediserl_nodelabel: "{{namespace}}-base"
redisjava_nodelabel: "{{namespace}}-base"
redisphp_nodelabel: "{{namespace}}-base"

fluentbit_server_nodelabel: "{{namespace}}-base"

msmongocs_nodelabel: "{{namespace}}-app"
msmongos_nodelabel: "{{namespace}}-app"
msmongoshard_nodelabel: "{{namespace}}-app"

# 需要创建localpv的node label
localpv_nodelabels: "{{ [ msmongocs_nodelabel,msmongos_nodelabel,msmongoshard_nodelabel,kafka_nodelabel,mongocs_nodelabel,mongos_nodelabel,mongoshard_nodelabel,mysql_nodelabel,zk_nodelabel,rabbitmq_nodelabel,rediserl_nodelabel,redisjava_nodelabel,redisphp_nodelabel] | unique }}"

titanbackup_nodelabel: "{{namespace}}-java"
patrol_nodelabel: "{{namespace}}-java"

connectagent_nodelabel: "{{namespace}}-java"
connectdh_nodelabel: "{{namespace}}-java"
connectselector_nodelabel: "{{namespace}}-java"
connectsh_nodelabel: "{{namespace}}-java"
detectsrv_nodelabel: "{{namespace}}-java"
gateway_nodelabel: "{{namespace}}-java"
uploadsrv_nodelabel: "{{namespace}}-java"
usersrv_nodelabel: "{{namespace}}-java"
wisteria_nodelabel: "{{namespace}}-java"
jobsrv_nodelabel: "{{namespace}}-java"
php_nodelabel: "{{namespace}}-php"
scansrv_nodelabel: "{{namespace}}-java"
clusterlinksrv_nodelabel: "{{namespace}}-java"
antivirussrv_nodelabel: "{{namespace}}-java"
mssrv_nodelabel: "{{namespace}}-app"
eventsrv_nodelabel: "{{namespace}}-app"

java_nodelabels: "{{ [connectdh_nodelabel,connectdh_nodelabel,connectselector_nodelabel,connectsh_nodelabel,detectsrv_nodelabel,gateway_nodelabel,uploadsrv_nodelabel,usersrv_nodelabel,wisteria_nodelabel,jobsrv_nodelabel,patrol_nodelabel,mssrv_nodelabel,eventsrv_nodelabel,antivirussrv_nodelabel,scansrv_nodelabel,clusterlinksrv_nodelabel] | unique }}"
java_images: "{{ [wisteria_image,upgradetool_image,gateway_image,usersrv_image,scansrv_image,clusterlinksrv_image,connectagent_image,connectdh_image,connectselector_image,connectsh_image,detectsrv_image,uploadsrv_image,uploadsrv_cdc_image,uploadsrv_ave_image,jobsrv_image,patrol_image,antivirussrv_image,mssrv_image,eventsrv_image] }}"

base_nodelabels:
  - "{{localpv_provisioner_nodelabel}}"
  - "{{csi_controller_nodelabel}}"
  - "{{glusterfs_nodelabel}}"
  - "{{kafka_nodelabel}}"
  - "{{mongocs_nodelabel}}"
  - "{{mongos_nodelabel}}"
  - "{{mongoshard_nodelabel}}"
  - "{{msmongocs_nodelabel}}"
  - "{{msmongos_nodelabel}}"
  - "{{msmongoshard_nodelabel}}"
  - "{{mysql_nodelabel}}"
  - "{{zk_nodelabel}}"
  - "{{rabbitmq_nodelabel}}"
  - "{{rediserl_nodelabel}}"
  - "{{redisjava_nodelabel}}"
  - "{{redisphp_nodelabel}}"

app_nodelabels: "{{java_nodelabels | union([php_nodelabel]) | unique }}"
all_nodelabels: "{{app_nodelabels | union(base_nodelabels) | unique }}"

keepalived_nodelabel: "{{php_nodelabel}}"

glusterfs_replicas: 3
rabbitmq_replicas: 3
mongos_replicas: 3
msmongos_replicas: 3
zk_replicas: 3
kafka_replicas: 3
#kafka topic副本数量，默认与kafka节点数量一致
replica_factor: "{{kafka_replicas}}"
#mongo分片数量，将默认根据节点数量来判断，节点数量小于等于3则1个分片，大于3则默认3个分片
#shard_num: 3
#mysql副本数量，默认为3
mysql_replicas: 3

# 默认不需要配置这个值，只有如SAAS这样需要对外暴露kafka集群时才需要配置
external_kafka_servers: ""

#默认的CPU请求
cpu_req: "0.1"

wisteria_replicas: 2
gateway_replicas: 2
usersrv_replicas: 2
scansrv_replicas: 2
clusterlinksrv_replicas: 2
uploadsrv_replicas: 2
jobsrv_replicas: 2
detectsrv_replicas: 2
connectagent_replicas: 2
connectdh_replicas: 2
connectselector_replicas: 2
eventsrv_replicas: 2
antivirussrv_replicas: 2
mssrv_replicas: 2
patrol_replicas: 1


javalog_storage_capacity: "18Gi"
titan_config_dir: "titan-config"

# 所有公共的角色
all_roles:
  - localpv
  - glusterfs
  - csi-glusterfs
  - zookeeper
  - kafka
  - mysql
  - rabbitmq
  - redisjava
  - redisphp
  - rediserl
  - mongo
  - mongo-ms-srv
  - keepalived
  - fluentbit
  - titan-backup
  - wisteria
  - gateway
  - user-srv
  - upload-srv
  - job-srv
  - detect-srv
  - connect-dh
  - connect-agent
  - connect-sh
  - connect-selector
  - go-patrol
  - php
  - ms-srv
  - event-srv
  - anti-virus-srv
  - scan-srv
  - clusterlink-srv

uninstall_sort_roles:
  - keepalived
  - php
  - go-patrol
  - wisteria
  - gateway
  - user-srv
  - detect-srv
  - job-srv
  - upload-srv
  - connect-agent
  - connect-selector
  - connect-sh
  - connect-dh
  - scan-srv
  - clusterlink-srv
  - ms-srv
  - event-srv
  - anti-virus-srv
  - rabbitmq
  - titan-backup
  - fluentbit
  - mongo-ms-srv
  - mongo
  - mysql
  - kafka
  - zookeeper
  - redisjava
  - redisphp
  - rediserl
  - csi-glusterfs
  - glusterfs
  - localpv

base_roles:
  - localpv
  - mysql
  - mongo
  - mongo-ms-srv
  - glusterfs
  - csi-glusterfs
  - zookeeper
  - kafka
  - rabbitmq
  - redisjava
  - redisphp
  - rediserl
  - keepalived
  - fluentbit
  - titan-backup

app_roles:
  - wisteria
  - gateway
  - user-srv
  - upload-srv
  - job-srv
  - detect-srv
  - connect-dh
  - connect-agent
  - connect-sh
  - connect-selector
  - go-patrol
  - php
  - ms-srv
  - event-srv
  - anti-virus-srv
  - scan-srv
  - clusterlink-srv

# 蜂巢容器的才包含这两个角色
app_hive_roles:
  - scan-srv
  - clusterlink-srv

extra_roles: []
mini_mode: false

ok_app_roles: []
ok_base_roles: []
install_roles: []

# 污点容忍
# 场景：客户提供了几台机器单独给我们使用，这几台机器打了污点，避免其他Pod调度过来抢占资源
# example
# tolerations:
# - key: "key1"
#   operator: "Equal"
#   value: "value1"
#   effect: "NoSchedule"  
tolerations: []

# 默认应用于所有Pod的可能需要的污点容忍度。如果只需要配置污点容忍，那么在titan-env.yml里添加tolerations即可 
# 其他可能存在的需要往这里添加公共配置的场景暂不确定， 如果有，那么需要在titan-env里定制修改
common_patch:
  spec:
    template:
      spec:
        tolerations: "{{tolerations}}"